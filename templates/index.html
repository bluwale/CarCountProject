<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  <title>MNN Parking Lot Counter</title>
  <!-- Include Socket.IO client library -->
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
</head>
<body>
  <header>
    <div class="container">
      <div class="logo">
        <img src="{{ url_for('static', filename='images/mnnLogo.png') }}" alt="MNN Logo" onerror="this.src='/api/placeholder/60/60'; this.onerror=null;">
        <div class="logo-text"></div>
      </div>
      <nav>
        <ul>
        </ul>
      </nav>
    </div>
  </header>
  
  <div class="container">
    <section class="counter-section">
      <h2 class="counter-title">Parking Lot Live Car Counter</h2>
      
      <div class="counter-display">
        <div class="count-label">Current Count</div>
        <div class="count-value" id="totalCars">{{ current_count|default(312) }}</div>
        <div class="count-unit">Cars</div>
      </div>
      
      <div class="timer-info">
        <span id="status-indicator" class="status-indicator"></span>
        <span id="status-text">Counter inactive</span> | Last updated: <span id="lastUpdated">{{ last_updated|default('N/A') }}</span>
      </div>
      
      <div class="control-buttons">
        <button id="startStopBtn" class="btn">Start</button>
        <button id="refreshBtn" class="btn btn-secondary">Refresh Count</button>
      </div>
      

    </section>
  </div>
  
  
  <footer>
    <div class="container">
      <div>
      </div>
      <div class="footer-copyright">
        &copy; 2025 Muslim Neighborhood Nexus (MNN). All rights reserved.
      </div>
    </div>
  </footer>

  <script>
    // Establish SocketIO connection
    const socket = io();

    // DOM Elements (note we now correctly use the 'totalCars' ID)
    const carCountElement = document.getElementById('totalCars');
    const startStopBtn = document.getElementById('startStopBtn');
    const refreshBtn = document.getElementById('refreshBtn');
    const statusIndicator = document.getElementById('status-indicator');
    const statusText = document.getElementById('status-text');
    const lastUpdatedElement = document.getElementById('lastUpdated');

    // Listen for live car count updates from the server
    socket.on('updateSensorData', function(data) {
      carCountElement.textContent = data.count;
      lastUpdatedElement.textContent = data.date;
    });

    // Optional: Handle Start/Stop button functionality.
    startStopBtn.addEventListener('click', function() {
      socket.emit("toggle_counting");
      if (startStopBtn.textContent === "Start") {
        startStopBtn.textContent = "Stop";
        statusIndicator.classList.add('status-active');
        statusText.textContent = 'Counter active';
      } else {
        startStopBtn.textContent = "Start";
        statusIndicator.classList.remove('status-active');
        statusText.textContent = 'Counter inactive';
        // TODO: emit an event to resume the counter on the server.
      }
    });

    refreshBtn.addEventListener('click', function() {
        socket.emit("manualRefresh");
    });
  </script>
</body>
</html>
